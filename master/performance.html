

<!DOCTYPE html>
<html class="no-js" lang="en">
    
    

    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width initial-scale=1" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <title>
             Performance tuning | ScyllaDB Docs 
        </title>
        <meta name="description" content="ScyllaDB is an Apache Cassandra-compatible NoSQL data store that can handle 1 million transactions per second on a single server." />
        <link rel="icon" href="_static/img/favicon.ico" type="image/x-icon" />
        <link rel="icon" href="_static/img/favicon-32x32.png" sizes="32x32" />
        <link rel="icon" href="_static/img/favicon-228x228.png" sizes="192x192" />
        <link rel="apple-touch-icon" href="_static/img/favicon-228x228.png" />
        <meta name="msapplication-TileImage" href="_static/img/favicon-228x228.png" />

        
            
            
        

        
            <link rel="canonical" href="https://operator.docs.scylladb.com/performance.html"/>
        

        <link rel="author" href="mailto:info@scylladb.com" />

        
            
        <!-- increase expertrec loading priority-->
        <link rel="dns-prefetch" href="https://cse.expertrec.com">

        <!-- increase font loading priority -->
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
        <link rel="preload" as="style"
            href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,400;0,500;0,700;1,400&display=swap" />

        <!-- async CSS -->
        <link rel="stylesheet" media="print" onload="this.onload=null;this.removeAttribute('media');"
            href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,400;0,500;0,700;1,400&display=swap" />

        <!-- no-JS fallback -->
        <noscript>
            <link rel="stylesheet"
                href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,400;0,500;0,700;1,400&display=swap" />
        </noscript>
        
            
                <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
            
        
            
                <link rel="stylesheet" type="text/css" href="_static/css/main.css" />
            
        
            
                <link rel="stylesheet" type="text/css" href="_static/sphinx_collapse.css" />
            
        
            
                <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
            
        
    
        
        
            

        <script type="text/javascript" id="documentation_options" data-url_root="./"
            src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/js/runtime.bundle.js"></script>
        <script type="text/javascript" src="_static/js/main.bundle.js"></script>
        
            
                <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
            
        
            
        
            
                <script src="_static/underscore.js"></script>
            
        
            
                <script src="_static/doctools.js"></script>
            
        
            
                <script src="_static/clipboard.min.js"></script>
            
        
            
                <script src="_static/copybutton.js"></script>
            
        
    
            <!- Zendesk tag -->
<meta name='zd-site-verification' content='gq6ltsh3nfex3cnwfy4aj9' />
<!-- Google Tag Manager -->
<script>
    (function (w, d, s, l, i) {
        w[l] = w[l] || [];
        w[l].push({
            "gtm.start": new Date().getTime(),
            event: "gtm.js"
        });
        var f = d.getElementsByTagName(s)[0],
        j = d.createElement(s),
        dl = l != "dataLayer" ? "&l=" + l : "";
        j.async = true;
        j.src = "https://www.googletagmanager.com/gtm.js?id=" + i + dl;
        f.parentNode.insertBefore(j, f);
    })(window, document, "script", "dataLayer", "GTM-T8P2JP");
</script>
<!-- End Google Tag Manager -->

<!-- Expertrec -->
<script>
    var id = "e2077224-9ccf-11e9-a0c9-0242ac130002";
    var ci_search = document.createElement("script");
    ci_search.type = "text/javascript";
    ci_search.async = true;
    ci_search.src = "https://cse.expertrec.com/api/js/ci_common.js?id=" + id;
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(ci_search, s);
</script>
<!-- End Expertrec -->
        
        <!-- Font Awesome -->
        <script src="https://kit.fontawesome.com/b1870adf6a.js" crossorigin="anonymous"></script>
        <!-- End Font Awesome -->
    </head>

    <body>
        
        <header class="header">
    <div class="header-logo">
        <a class="header-logo__img" href="https://scylladb.com/">
            <img src="_static/img/logo-docs.svg" alt="ScyllaDB Documentation Logo" />
        </a>
        <span class="header-logo__bar"></span>
        <a class="header-logo__text" href="https://docs.scylladb.com/">
            Documentation
        </a>
    </div>
    <div class="header-navigation">
        <ul class="dropdown menu scylla-dropdown scylla-dropdown--header" data-dropdown-menu>
            <li class="scylla-dropdown__item">
                <a href="#" class="scylla-dropdown__title">Server
                    <i class="chevron scylla-icon scylla-icon--triangle-down"></i></a>
                <ul class="menu scylla-dropdown__content">
                    <li>
                        <a href="https://docs.scylladb.com/">
                            <i class="scylla-icon scylla-icon--about-us"></i>
                            ScyllaDB Open Source
                        </a>
                    </li>
                    <li>
                        <a href="https://enterprise.docs.scylladb.com/">
                            <i class="scylla-icon scylla-icon--enterprise"></i>ScyllaDB Enterprise
                        </a>
                    </li>
                    <li>
                        <a href="https://scylla.docs.scylladb.com/stable/alternator/alternator.html">
                            <i class="scylla-icon scylla-icon--overview"></i>
                            ScyllaDB Alternator
                        </a>
                    </li>
                </ul>
            </li>
            <li class="scylla-dropdown__item">
                <a href="https://docs.scylladb.com/scylla-cloud/" class="scylla-dropdown__title">Cloud</a>
            </li>
            <li class="scylla-dropdown__item">
                <a href="#" class="scylla-dropdown__title">Tools <i
                    class="chevron scylla-icon scylla-icon--triangle-down"></i></a>
                <ul class="menu scylla-dropdown__content">
                    <li>
                        <a href="https://manager.docs.scylladb.com/">
                            <i class="scylla-icon scylla-icon--manager"></i>ScyllaDB Manager</a>
                    </li>
                    <li>
                        <a href="https://monitoring.docs.scylladb.com/">
                            <i class="scylla-icon scylla-icon--monitoring"></i>ScyllaDB
                            Monitoring Stack</a>
                    </li>
                    <li>
                        <a href="https://operator.docs.scylladb.com/">
                            <i class="scylla-icon scylla-icon--operator"></i>ScyllaDB Operator
                        </a>
                    </li>
                </ul>
            </li>
            <li class="scylla-dropdown__item">
                <a href="#" class="scylla-dropdown__title">Drivers <i
                    class="chevron scylla-icon scylla-icon--triangle-down"></i></a>
                <ul class="menu scylla-dropdown__content">
                    <li>
                        <a href="https://docs.scylladb.com/using-scylla/drivers/cql-drivers/">
                            <i class="scylla-icon scylla-icon--nsql-guides"></i>CQL Drivers
                        </a>
                    </li>
                    <li>
                        <a href="https://docs.scylladb.com/using-scylla/drivers/dynamo-drivers/">
                            <i class="scylla-icon scylla-icon--overview"></i>DynamoDB Drivers
                        </a>
                    </li>
                </ul>
            </li>
        </ul>
        <div class="header-button">
            <a href="https://www.scylladb.com/download/" class="button">Download</a>
        </div>
    </div>
    <div class="header-search-box">
        <div class="search-box">
            <ci-search></ci-search>
        </div>
    </div>
    <div class="side-nav-toggle" data-toggle="side-nav">
    <div class="side-nav-toggle__button">
        <img src="_static/img/menu.svg" alt="Menu" />
    </div>
</div>
</header>
        <section
            class="layout  layout--sidebar layout--has-secondary-sidebar ">
            <div class="content large-order-2">
                
                    
                
                
                    <div class="pre-content">
                        <div class="breadcrumbs">
    <span class="bread__item">
        <a href="https://docs.scylladb.com"
            class="bread__highlight">
            <i class="fas fa-home"></i> ScyllaDB Docs
        </a>
    </span>
    <span class="bread__item">
        <a href="index.html"
            class="bread__highlight">
            Scylla Operator
        </a>
    </span>
    
    <span class="bread__item bread__item--last">Performance tuning</span>
</div>
                    </div>
                
                <section id="performance-tuning">
<h1>Performance tuning<a class="headerlink" href="#performance-tuning" title="Permalink to this headline">¶</a></h1>
<p>Scylla Operator 1.6 introduces a new experimental feature allowing users to optimize Kubernetes nodes.</p>
<section id="node-tuning">
<h2>Node tuning<a class="headerlink" href="#node-tuning" title="Permalink to this headline">¶</a></h2>
<p>Starting from Operator 1.6, a new CRD called NodeConfig is available, allowing users to target Nodes which should be tuned.
When a Node is supposed to be optimized, the Scylla Operator creates a DaemonSet covering these Nodes.
Nodes matching the provided placement conditions will be subject to tuning.</p>
<p>Below example NodeConfig tunes nodes having <code class="docutils literal notranslate"><span class="pre">scylla.scylladb.com/node-type=scylla</span></code> label:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">apiVersion</span><span class="p">:</span> <span class="n">scylla</span><span class="o">.</span><span class="n">scylladb</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">v1alpha1</span>
<span class="n">kind</span><span class="p">:</span> <span class="n">NodeConfig</span>
<span class="n">metadata</span><span class="p">:</span>
 <span class="n">name</span><span class="p">:</span> <span class="n">cluster</span>
<span class="n">spec</span><span class="p">:</span>
 <span class="n">placement</span><span class="p">:</span>
   <span class="n">nodeSelector</span><span class="p">:</span>
     <span class="n">scylla</span><span class="o">.</span><span class="n">scylladb</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">node</span><span class="o">-</span><span class="nb">type</span><span class="p">:</span> <span class="n">scylla</span>
</pre></div>
</div>
<p>For more details about new CRD use:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">kubectl</span> <span class="n">explain</span> <span class="n">nodeconfigs</span><span class="o">.</span><span class="n">scylla</span><span class="o">.</span><span class="n">scylladb</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">v1alpha1</span>
</pre></div>
</div>
<p>For all optimizations we use a Python script available in the Scylla image called perftune.
Perftune executes the performance optmizations like tuning the kernel, network, disk devices, spreading IRQs across CPUs and more.</p>
<p>Tuning consists of two separate optimizations: common node tuning, and tuning based on Scylla Pods and their resource assignment.
Node tuning is executed immediately. Pod tuning is executed when Scylla Pod lands on the same Node.</p>
<p>Scylla works most efficently when it’s pinned to CPU and not interrupted.
One of the most common causes of context-switching are network interrupts. Packets coming to a node need to be processed,
and this requires CPU shares.</p>
<p>On K8s we always have at least a couple of processes running on the node: kubelet, kubernetes provider applications, daemons etc.
These processes require CPU shares, so we cannot dedicate entire node processing power to Scylla, we need to leave space for others.<br />We take advantage of it, and we pin IRQs to CPUs not used by any Scylla Pods exclusively.</p>
<p>Tuning resources are created in a special namespace called <code class="docutils literal notranslate"><span class="pre">scylla-operator-node-tuning</span></code>.</p>
<p>The tuning is applied only to pods with <code class="docutils literal notranslate"><span class="pre">Guaranteed</span></code> QoS class. Please double check your ScyllaCluster resource specification
to see if it meets all conditions.</p>
</section>
<section id="kubernetes-tuning">
<h2>Kubernetes tuning<a class="headerlink" href="#kubernetes-tuning" title="Permalink to this headline">¶</a></h2>
<p>By default, the kubelet uses the CFS quota to enforce pod CPU limits.<br />When the node runs many CPU-bound pods, the workload can move around different CPU cores depending on whether the pod
is throttled and which CPU cores are available.
However, kubelet may be configured to assign CPUs exclusively, by setting the CPU manager policy to static.</p>
<p>Setting up kubelet configuration is provider specific. Please check the docs for your distribution or talk to your
provider.</p>
<p>Only pods within the <a class="reference external" href="https://kubernetes.io/docs/tasks/configure-pod-container/quality-service-pod/#create-a-pod-that-gets-assigned-a-qos-class-of-guaranteed">Guaranteed QoS class</a>) can take advantage of this option.
When such pod lands on a Node, kubelet will pin them to specific CPUs, and those won’t be part of the shared pool.</p>
<p>In our case there are two requirements each ScyllaCluster must fulfill to receive a Guaranteed QoS class:</p>
<ul class="simple">
<li><p>resource request and limits must be equal or only limits have to be provided</p></li>
<li><p>agentResources must be provided and their requests and limits must be equal, or only limits have to be provided</p></li>
</ul>
<p>An example of such a ScyllaCluster that receives a Guaranteed QoS class is below:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">apiVersion</span><span class="p">:</span> <span class="n">scylla</span><span class="o">.</span><span class="n">scylladb</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">v1</span>
<span class="n">kind</span><span class="p">:</span> <span class="n">ScyllaCluster</span>
<span class="n">metadata</span><span class="p">:</span>
  <span class="n">name</span><span class="p">:</span> <span class="n">guaranteed</span><span class="o">-</span><span class="n">cluster</span>
  <span class="n">namespace</span><span class="p">:</span> <span class="n">scylla</span>
<span class="n">spec</span><span class="p">:</span>
  <span class="n">version</span><span class="p">:</span> <span class="mf">4.5.1</span>
  <span class="n">agentVersion</span><span class="p">:</span> <span class="mf">2.5.2</span>
  <span class="n">datacenter</span><span class="p">:</span>
    <span class="n">name</span><span class="p">:</span> <span class="n">us</span><span class="o">-</span><span class="n">east</span><span class="o">-</span><span class="mi">1</span>
    <span class="n">racks</span><span class="p">:</span>
    <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">us</span><span class="o">-</span><span class="n">east</span><span class="o">-</span><span class="mi">1</span><span class="n">a</span>
      <span class="n">members</span><span class="p">:</span> <span class="mi">3</span>
      <span class="n">storage</span><span class="p">:</span>
        <span class="n">capacity</span><span class="p">:</span> <span class="mi">500</span><span class="n">Gi</span>
      <span class="n">agentResources</span><span class="p">:</span>
        <span class="n">requests</span><span class="p">:</span>
          <span class="n">cpu</span><span class="p">:</span> <span class="mi">1</span>
          <span class="n">memory</span><span class="p">:</span> <span class="mi">1</span><span class="n">G</span>
        <span class="n">limits</span><span class="p">:</span>
          <span class="n">cpu</span><span class="p">:</span> <span class="mi">1</span>
          <span class="n">memory</span><span class="p">:</span> <span class="mi">1</span><span class="n">G</span>
      <span class="n">resources</span><span class="p">:</span>
        <span class="n">requests</span><span class="p">:</span>
          <span class="n">cpu</span><span class="p">:</span> <span class="mi">4</span>
          <span class="n">memory</span><span class="p">:</span> <span class="mi">16</span><span class="n">G</span>
        <span class="n">limits</span><span class="p">:</span>
          <span class="n">cpu</span><span class="p">:</span> <span class="mi">4</span>
          <span class="n">memory</span><span class="p">:</span> <span class="mi">16</span><span class="n">G</span>
</pre></div>
</div>
</section>
</section>

                
                    <div class="post-content">
                        <div class="content-navigation">
    <div class="navigation navigation--prev">
        
            <a class="navigation__link" href="nodeoperations/restore.html">
                <button class="navigation__button">
                    <i class="scylla-icon scylla-icon--chevron-left"></i>
                </button>
                <div class="navigation__title">
                    <span class="colored">PREVIOUS</span> <br />Restore from backup
                </div>
            </a>
        
    </div>
    <div class="navigation navigation--next">
        
            <a class="navigation__link" href="upgrade.html">
                <div class="navigation__title">
                    <span class="colored">NEXT</span> <br />Upgrade of Scylla Operator
                </div>
                <button class="navigation__button">
                    <i class="scylla-icon scylla-icon--chevron-right"></i>
                </button>
            </a>
        
    </div>
</div>
                        <!-- Post content text -->
                    </div>
                
            </div>
            <div class="sidebar-left  large-order-1">
                
                    
                        <div id="side-nav" class="side-nav custom-scroll-bar" data-closable data-toggler=".show">
    <button class="collapsible-button">
        <i class="scylla-icon scylla-icon--chevron-left"></i>
    </button>
    <div class="side-nav-content">
        <div class="side-nav__search">
            <div class="search-box">
                <ci-search></ci-search>
            </div>
        </div>
        <div class="side-nav__title">
            Scylla Operator
        </div>
        <div class="side-nav__versions"><ul class="dropdown menu scylla-dropdown scylla-dropdown--versions" data-dropdown-menu>
    <li class="scylla-dropdown__item">
        <a class="scylla-dropdown__title" href="#">
            
                master
            
            <i class="chevron scylla-icon scylla-icon--chevron-right"></i>
        </a>
        <ul class="menu scylla-dropdown__content">
            
                
                    <li>
                        <a href="performance.html">master</a>
                    </li>
                
            
            
        </ul>
    </li>
</ul></div>
        <div class="side-nav__content">
            <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="generic.html">Deploying Scylla on a Kubernetes Cluster</a></li>
<li class="toctree-l1"><a class="reference internal" href="eks.html">Deploying Scylla on EKS</a></li>
<li class="toctree-l1"><a class="reference internal" href="gke.html">Deploying Scylla on GKE</a></li>
<li class="toctree-l1"><a class="reference internal" href="helm.html">Deploying Scylla stack using Helm Charts</a></li>
<li class="toctree-l1"><a class="reference internal" href="manager.html">Deploying Scylla Manager on a Kubernetes Cluster</a></li>
<li class="toctree-l1"><a class="reference internal" href="monitoring.html">Monitoring</a></li>
<li class="toctree-l1"><a class="reference internal" href="migration.html">Version  migrations</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="nodeoperations/index.html">Node operations using Scylla Operator</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label for="toctree-checkbox-1"><i class="scylla-icon scylla-icon--expand"></i></label><div class="break"></div><ul>
<li class="toctree-l2"><a class="reference internal" href="nodeoperations/scylla_upgrade.html">Upgrading version of Scylla</a></li>
<li class="toctree-l2"><a class="reference internal" href="nodeoperations/replace_node.html">Replacing a Scylla node</a></li>
<li class="toctree-l2"><a class="reference internal" href="nodeoperations/automatic_cleanup.html">Automatic cleanup and replacement in case when k8s node is lost</a></li>
<li class="toctree-l2"><a class="reference internal" href="nodeoperations/maintenance_mode.html">Maintenance mode</a></li>
<li class="toctree-l2"><a class="reference internal" href="nodeoperations/restore.html">Restore from backup</a></li>
</ul>
</li>
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">Performance tuning</a></li>
<li class="toctree-l1"><a class="reference internal" href="upgrade.html">Upgrade of Scylla Operator</a></li>
<li class="toctree-l1"><a class="reference internal" href="releases.html">Releases</a></li>
<li class="toctree-l1"><a class="reference internal" href="known_issues.html">Known issues</a></li>
<li class="toctree-l1"><a class="reference internal" href="scylla_cluster_crd.html">Scylla Cluster CRD</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributing.html">Contributing to Scylla Operator</a></li>
</ul>

        </div>
    </div>
</div>
                    
                
            </div>
            
                <div class="sidebar-right large-order-3">
                    <div class="secondary-side-nav custom-scroll-bar">
    
    <ul class="contribute">
        <li class="contribute__item">
            <a href="https://github.com/scylladb/scylla-operator/issues/new?title=docs:%20Issue in page Performance tuning&&body=I%20would%20like%20to%20report%20an%20issue%20in%20page%20https://operator.docs.scylladb.com/master/performance%0A%0A%23%23%23%20Problem%0A%0A%23%23%23%20%20Suggest%20a%20fix&labels=documentation"
                target="_blank">
                <i class="icon fab fa-github" aria-hidden="true"></i>Create an issue
            </a>
        </li>
        
            <li class="contribute__item">
                <a href="https://github.com/scylladb/scylla-operator/edit/master/docs/source/performance.md"
                    target="_blank">
                    <i class="icon fa fa-edit" aria-hidden="true"></i>Edit this page
                </a>
            </li>
        
    </ul>

    
        <div class="secondary-side-nav__content">
            <p class="topic-title">On this page</p>
            <ul>
<li><a class="reference internal" href="#">Performance tuning</a><ul>
<li><a class="reference internal" href="#node-tuning">Node tuning</a></li>
<li><a class="reference internal" href="#kubernetes-tuning">Kubernetes tuning</a></li>
</ul>
</li>
</ul>

        </div>
    
</div>
                </div>
            
        </section>

        <footer class="footer">
    <div class="footer-group">
        <div class="footer-top">
            <a class="footer-logo" href="https://www.scylladb.com">
                <img src="_static/img/logo-scylla-horizontal-RGB.svg" alt="Logo" />
            </a>
            <div class="footer-links">
                <a class="footer-links__link" href="https://docs.scylladb.com/">Docs</a>
                <a class="footer-links__link" href="https://www.scylladb.com/company/contact-us/">Contact Us</a>
                <a class="footer-links__link" href="https://www.scylladb.com/company/">About Us</a>
            </div>
            <div class="footer-actions">
                <a class="footer-actions__link" href="https://groups.google.com/g/scylladb-users" target="_blank">
                    <span data-tooltip tabindex="1" title="User mailing list" data-position="bottom">
                        <img src="_static/img/icons/icon-mail-list.svg" alt="Mail List Icon" />
                    </span>
                </a>
                <a class="footer-actions__link" href="http://slack.scylladb.com/" target="_blank">
                    <span data-tooltip tabindex="1" title="User Slack channel" data-position="bottom">
                        <img src="_static/img/icons/icon-slack.svg" alt="Slack Icon" />
                    </span>
                </a>
                <a class="footer-actions__link" href="https://forum.scylladb.com/" target="_blank">
                    <span data-tooltip tabindex="1" title="Community forum" data-position="bottom">
                        <img src="_static/img/icons/icon-forum.svg" alt="Forum Icon" />
                    </span>
                </a>
            </div>
        </div>

        <div class="footer-bottom">
            
                <div class="footer-bottom__copyright">
                    
                        
                            &#169; 2023, ScyllaDB. All rights reserved.
                        
                    
                </div>
            
            
                <div class="footer-bottom__last-updated">
                    
                        Last updated on 18 May 2023.
                    
                </div>
            
            <div class="footer-bottom__version">
                Powered by
                <a href="http://sphinx-doc.org/">Sphinx 4.5.0</a> &amp;
                <a href="https://sphinx-theme.scylladb.com/">ScyllaDB Theme 1.3.5</a>
            </div>
        </div>
    </div>
</footer>

        <noscript>
            <iframe src="https://www.googletagmanager.com/ns.html?id=GTM-T8P2JP" height="0" width="0"
                style="display: none; visibility: hidden"></iframe>
        </noscript>
    </body>

</html>