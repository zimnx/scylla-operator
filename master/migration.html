

<!DOCTYPE html>
<html class="no-js" lang="en">
    
    

    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width initial-scale=1" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <title>
             Version migrations | ScyllaDB Docs 
        </title>
        <meta name="description" content="ScyllaDB is an Apache Cassandra-compatible NoSQL data store that can handle 1 million transactions per second on a single server." />
        <link rel="icon" href="_static/img/favicon.ico" type="image/x-icon" />
        <link rel="icon" href="_static/img/favicon-32x32.png" sizes="32x32" />
        <link rel="icon" href="_static/img/favicon-228x228.png" sizes="192x192" />
        <link rel="apple-touch-icon" href="_static/img/favicon-228x228.png" />
        <meta name="msapplication-TileImage" href="_static/img/favicon-228x228.png" />

        
            
            
        

        
            <link rel="canonical" href="https://operator.docs.scylladb.com/migration.html"/>
        

        <link rel="author" href="mailto:info@scylladb.com" />

        
            
        <!-- increase expertrec loading priority-->
        <link rel="dns-prefetch" href="https://cse.expertrec.com">

        <!-- increase font loading priority -->
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
        <link rel="preload" as="style"
            href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,400;0,500;0,700;1,400&display=swap" />

        <!-- async CSS -->
        <link rel="stylesheet" media="print" onload="this.onload=null;this.removeAttribute('media');"
            href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,400;0,500;0,700;1,400&display=swap" />

        <!-- no-JS fallback -->
        <noscript>
            <link rel="stylesheet"
                href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,400;0,500;0,700;1,400&display=swap" />
        </noscript>
        
            
                <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
            
        
            
                <link rel="stylesheet" type="text/css" href="_static/css/main.css" />
            
        
            
                <link rel="stylesheet" type="text/css" href="_static/sphinx_collapse.css" />
            
        
            
                <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
            
        
    
        
        
            

        <script type="text/javascript" id="documentation_options" data-url_root="./"
            src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/js/runtime.bundle.js"></script>
        <script type="text/javascript" src="_static/js/main.bundle.js"></script>
        
            
                <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
            
        
            
        
            
                <script src="_static/underscore.js"></script>
            
        
            
                <script src="_static/doctools.js"></script>
            
        
            
                <script src="_static/clipboard.min.js"></script>
            
        
            
                <script src="_static/copybutton.js"></script>
            
        
    
            <!- Zendesk tag -->
<meta name='zd-site-verification' content='gq6ltsh3nfex3cnwfy4aj9' />
<!-- Google Tag Manager -->
<script>
    (function (w, d, s, l, i) {
        w[l] = w[l] || [];
        w[l].push({
            "gtm.start": new Date().getTime(),
            event: "gtm.js"
        });
        var f = d.getElementsByTagName(s)[0],
        j = d.createElement(s),
        dl = l != "dataLayer" ? "&l=" + l : "";
        j.async = true;
        j.src = "https://www.googletagmanager.com/gtm.js?id=" + i + dl;
        f.parentNode.insertBefore(j, f);
    })(window, document, "script", "dataLayer", "GTM-T8P2JP");
</script>
<!-- End Google Tag Manager -->

<!-- Expertrec -->
<script>
    var id = "e2077224-9ccf-11e9-a0c9-0242ac130002";
    var ci_search = document.createElement("script");
    ci_search.type = "text/javascript";
    ci_search.async = true;
    ci_search.src = "https://cse.expertrec.com/api/js/ci_common.js?id=" + id;
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(ci_search, s);
</script>
<!-- End Expertrec -->
        
        <!-- Font Awesome -->
        <script src="https://kit.fontawesome.com/b1870adf6a.js" crossorigin="anonymous"></script>
        <!-- End Font Awesome -->
    </head>

    <body>
        
        <header class="header">
    <div class="header-logo">
        <a class="header-logo__img" href="https://scylladb.com/">
            <img src="_static/img/logo-docs.svg" alt="ScyllaDB Documentation Logo" />
        </a>
        <span class="header-logo__bar"></span>
        <a class="header-logo__text" href="https://docs.scylladb.com/">
            Documentation
        </a>
    </div>
    <div class="header-navigation">
        <ul class="dropdown menu scylla-dropdown scylla-dropdown--header" data-dropdown-menu>
            <li class="scylla-dropdown__item">
                <a href="#" class="scylla-dropdown__title">Server
                    <i class="chevron scylla-icon scylla-icon--triangle-down"></i></a>
                <ul class="menu scylla-dropdown__content">
                    <li>
                        <a href="https://docs.scylladb.com/">
                            <i class="scylla-icon scylla-icon--about-us"></i>
                            ScyllaDB Open Source
                        </a>
                    </li>
                    <li>
                        <a href="https://enterprise.docs.scylladb.com/">
                            <i class="scylla-icon scylla-icon--enterprise"></i>ScyllaDB Enterprise
                        </a>
                    </li>
                    <li>
                        <a href="https://scylla.docs.scylladb.com/stable/alternator/alternator.html">
                            <i class="scylla-icon scylla-icon--overview"></i>
                            ScyllaDB Alternator
                        </a>
                    </li>
                </ul>
            </li>
            <li class="scylla-dropdown__item">
                <a href="https://docs.scylladb.com/scylla-cloud/" class="scylla-dropdown__title">Cloud</a>
            </li>
            <li class="scylla-dropdown__item">
                <a href="#" class="scylla-dropdown__title">Tools <i
                    class="chevron scylla-icon scylla-icon--triangle-down"></i></a>
                <ul class="menu scylla-dropdown__content">
                    <li>
                        <a href="https://manager.docs.scylladb.com/">
                            <i class="scylla-icon scylla-icon--manager"></i>ScyllaDB Manager</a>
                    </li>
                    <li>
                        <a href="https://monitoring.docs.scylladb.com/">
                            <i class="scylla-icon scylla-icon--monitoring"></i>ScyllaDB
                            Monitoring Stack</a>
                    </li>
                    <li>
                        <a href="https://operator.docs.scylladb.com/">
                            <i class="scylla-icon scylla-icon--operator"></i>ScyllaDB Operator
                        </a>
                    </li>
                </ul>
            </li>
            <li class="scylla-dropdown__item">
                <a href="#" class="scylla-dropdown__title">Drivers <i
                    class="chevron scylla-icon scylla-icon--triangle-down"></i></a>
                <ul class="menu scylla-dropdown__content">
                    <li>
                        <a href="https://docs.scylladb.com/using-scylla/drivers/cql-drivers/">
                            <i class="scylla-icon scylla-icon--nsql-guides"></i>CQL Drivers
                        </a>
                    </li>
                    <li>
                        <a href="https://docs.scylladb.com/using-scylla/drivers/dynamo-drivers/">
                            <i class="scylla-icon scylla-icon--overview"></i>DynamoDB Drivers
                        </a>
                    </li>
                </ul>
            </li>
        </ul>
        <div class="header-button">
            <a href="https://www.scylladb.com/download/" class="button">Download</a>
        </div>
    </div>
    <div class="header-search-box">
        <div class="search-box">
            <ci-search></ci-search>
        </div>
    </div>
    <div class="side-nav-toggle" data-toggle="side-nav">
    <div class="side-nav-toggle__button">
        <img src="_static/img/menu.svg" alt="Menu" />
    </div>
</div>
</header>
        <section
            class="layout  layout--sidebar layout--has-secondary-sidebar ">
            <div class="content large-order-2">
                
                    
                
                
                    <div class="pre-content">
                        <div class="breadcrumbs">
    <span class="bread__item">
        <a href="https://docs.scylladb.com"
            class="bread__highlight">
            <i class="fas fa-home"></i> ScyllaDB Docs
        </a>
    </span>
    <span class="bread__item">
        <a href="index.html"
            class="bread__highlight">
            Scylla Operator
        </a>
    </span>
    
    <span class="bread__item bread__item--last">Version  migrations</span>
</div>
                    </div>
                
                <section id="version-migrations">
<h1>Version  migrations<a class="headerlink" href="#version-migrations" title="Permalink to this headline">¶</a></h1>
<section id="v0-3-0-v1-0-0-migration">
<h2><code class="docutils literal notranslate"><span class="pre">v0.3.0</span></code> -&gt; <code class="docutils literal notranslate"><span class="pre">v1.0.0</span></code> migration<a class="headerlink" href="#v0-3-0-v1-0-0-migration" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">v0.3.0</span></code> used a very common name as a CRD kind (<code class="docutils literal notranslate"><span class="pre">Cluster</span></code>). In <code class="docutils literal notranslate"><span class="pre">v1.0.0</span></code> this issue was solved by using less common kind
which is easier to disambiguate (<code class="docutils literal notranslate"><span class="pre">ScyllaCluster</span></code>).
<em><strong>This change is backward incompatible, which means manual migration is needed.</strong></em></p>
<p>This procedure involves having two CRDs registered at the same time. We will detach Scylla Pods
from Scylla Operator for a short period to ensure that nothing is garbage collected when Scylla Operator is upgraded.
Compared to the <a class="reference internal" href="upgrade.html"><span class="doc">upgrade guide</span></a> where full deletion is requested, this procedure shouldn’t cause downtimes.
Although detaching resources from their controller is considered hacky. This means that you shouldn’t run procedure
out of the box on production. Make sure this procedure works well multiple times on your staging environment first.</p>
<p><em><strong>Read the whole procedure and make sure you understand what is going on before executing any of the commands!</strong></em></p>
<p>In case of any issues or questions regarding this procedure, you’re welcomed on our <a class="reference external" href="http://slack.scylladb.com/">Scylla Users Slack</a>
on #kubernetes channel.</p>
</section>
<section id="procedure">
<h2>Procedure<a class="headerlink" href="#procedure" title="Permalink to this headline">¶</a></h2>
<ol>
<li><p>Execute this whole procedure for each cluster sequentially. To get a list of existing clusters execute the following</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">kubectl</span> <span class="o">-</span><span class="n">n</span> <span class="n">scylla</span> <span class="n">get</span> <span class="n">cluster</span><span class="o">.</span><span class="n">scylla</span><span class="o">.</span><span class="n">scylladb</span><span class="o">.</span><span class="n">com</span>

<span class="n">NAME</span>             <span class="n">AGE</span>
<span class="n">simple</span><span class="o">-</span><span class="n">cluster</span>   <span class="mi">30</span><span class="n">m</span>
</pre></div>
</div>
<p>All below commands will use <code class="docutils literal notranslate"><span class="pre">scylla</span></code> namespace and <code class="docutils literal notranslate"><span class="pre">simple-cluster</span></code> as a cluster name.</p>
</li>
<li><p>Make sure you’re using v1.0.0 tag:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">checkout</span> <span class="n">v1</span><span class="mf">.0.0</span>
</pre></div>
</div>
</li>
<li><p>Upgrade your <code class="docutils literal notranslate"><span class="pre">cert-manager</span></code> to <code class="docutils literal notranslate"><span class="pre">v1.0.0</span></code>. If you installed it from a static file from this repo, simply execute the following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span> <span class="n">kubectl</span> <span class="n">apply</span> <span class="o">-</span><span class="n">f</span> <span class="n">examples</span><span class="o">/</span><span class="n">common</span><span class="o">/</span><span class="n">cert</span><span class="o">-</span><span class="n">manager</span><span class="o">.</span><span class="n">yaml</span>
</pre></div>
</div>
<p>If your <code class="docutils literal notranslate"><span class="pre">cert-manager</span></code> was installed in another way, follow official instructions on <code class="docutils literal notranslate"><span class="pre">cert-manager</span></code> website.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">examples/common/operator.yaml</span></code> file contains multiple resources. Extract <strong>only</strong> <code class="docutils literal notranslate"><span class="pre">CustomResourceDefinition</span></code> to separate file.</p></li>
<li><p>Install v1.0.0 CRD definition from file created in the previous step:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">kubectl</span> <span class="n">apply</span> <span class="o">-</span><span class="n">f</span> <span class="n">examples</span><span class="o">/</span><span class="n">common</span><span class="o">/</span><span class="n">crd</span><span class="o">.</span><span class="n">yaml</span>
</pre></div>
</div>
</li>
<li><p>Save your existing <code class="docutils literal notranslate"><span class="pre">simple-cluster</span></code> Cluster definition to a file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">kubectl</span> <span class="o">-</span><span class="n">n</span> <span class="n">scylla</span> <span class="n">get</span> <span class="n">cluster</span><span class="o">.</span><span class="n">scylla</span><span class="o">.</span><span class="n">scylladb</span><span class="o">.</span><span class="n">com</span> <span class="n">simple</span><span class="o">-</span><span class="n">cluster</span> <span class="o">-</span><span class="n">o</span> <span class="n">yaml</span> <span class="o">&gt;</span> <span class="n">existing</span><span class="o">-</span><span class="n">cluster</span><span class="o">.</span><span class="n">yaml</span>
</pre></div>
</div>
</li>
<li><p>Migrate <code class="docutils literal notranslate"><span class="pre">Kind</span></code> and <code class="docutils literal notranslate"><span class="pre">ApiVersion</span></code> to new values using:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sed</span> <span class="o">-</span><span class="n">i</span> <span class="s1">&#39;s/scylla.scylladb.com\/v1alpha1/scylla.scylladb.com\/v1/g&#39;</span> <span class="n">existing</span><span class="o">-</span><span class="n">cluster</span><span class="o">.</span><span class="n">yaml</span>
<span class="n">sed</span> <span class="o">-</span><span class="n">i</span> <span class="s1">&#39;s/kind: Cluster/kind: ScyllaCluster/g&#39;</span> <span class="n">existing</span><span class="o">-</span><span class="n">cluster</span><span class="o">.</span><span class="n">yaml</span>
</pre></div>
</div>
</li>
<li><p>Install migrated CRD instance</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">kubectl</span> <span class="n">apply</span> <span class="o">-</span><span class="n">f</span> <span class="n">existing</span><span class="o">-</span><span class="n">cluster</span><span class="o">.</span><span class="n">yaml</span>
</pre></div>
</div>
<p>At this point, we should have two CRDs describing your Scylla cluster, although the new one is not controlled by the Operator.</p>
</li>
<li><p>Get UUID of newly created ScyllaCluster resource:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">kubectl</span> <span class="o">-</span><span class="n">n</span> <span class="n">scylla</span> <span class="n">get</span> <span class="n">ScyllaCluster</span> <span class="n">simple</span><span class="o">-</span><span class="n">cluster</span> <span class="o">--</span><span class="n">template</span><span class="o">=</span><span class="s2">&quot;{{ .metadata.uid }}&quot;</span>

<span class="mi">12</span><span class="n">a3678d</span><span class="o">-</span><span class="mi">8511</span><span class="o">-</span><span class="mi">4</span><span class="n">c9c</span><span class="o">-</span><span class="mi">8</span><span class="n">a48</span><span class="o">-</span><span class="n">fa78d3992694</span>
</pre></div>
</div>
<p>Save output UUID somewhere, it will be referred as <code class="docutils literal notranslate"><span class="pre">&lt;new-cluster-uid&gt;</span></code> in commands below.</p>
<p><em><strong>Depending on your shell, you might get additional ‘%’ sign at the end of UUID, make sure to remove it!</strong></em></p>
</li>
<li><p>Upgrade ClusterRole attached to each of the Scylla nodes to grant them permission to lookup Scylla clusters:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">kubectl</span> <span class="n">patch</span> <span class="n">ClusterRole</span> <span class="n">simple</span><span class="o">-</span><span class="n">cluster</span><span class="o">-</span><span class="n">member</span> <span class="o">--</span><span class="nb">type</span> <span class="s2">&quot;json&quot;</span> <span class="o">-</span><span class="n">p</span> <span class="s1">&#39;[{&quot;op&quot;:&quot;add&quot;,&quot;path&quot;:&quot;/rules/-&quot;,&quot;value&quot;:{&quot;apiGroups&quot;:[&quot;scylla.scylladb.com&quot;],&quot;resources&quot;:[&quot;scyllaclusters&quot;],&quot;verbs&quot;:[&quot;get&quot;]}}]&#39;</span>
</pre></div>
</div>
<p>Amend role name according to your cluster name, it should look like <code class="docutils literal notranslate"><span class="pre">&lt;scylla-cluster-name&gt;-member</span></code>.</p>
</li>
<li><p>Get a list of all Services associated with your cluster. First get list of all services:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span> <span class="n">kubectl</span> <span class="o">-</span><span class="n">n</span> <span class="n">scylla</span> <span class="n">get</span> <span class="n">svc</span> <span class="o">-</span><span class="n">l</span> <span class="s2">&quot;scylla/cluster=simple-cluster&quot;</span>

 <span class="n">NAME</span>                                    <span class="n">TYPE</span>        <span class="n">CLUSTER</span><span class="o">-</span><span class="n">IP</span>     <span class="n">EXTERNAL</span><span class="o">-</span><span class="n">IP</span>   <span class="n">PORT</span><span class="p">(</span><span class="n">S</span><span class="p">)</span>                                                           <span class="n">AGE</span>
 <span class="n">simple</span><span class="o">-</span><span class="n">cluster</span><span class="o">-</span><span class="n">client</span>                   <span class="n">ClusterIP</span>   <span class="kc">None</span>           <span class="o">&lt;</span><span class="n">none</span><span class="o">&gt;</span>        <span class="mi">9180</span><span class="o">/</span><span class="n">TCP</span>                                                          <span class="mi">109</span><span class="n">m</span>
 <span class="n">simple</span><span class="o">-</span><span class="n">cluster</span><span class="o">-</span><span class="n">us</span><span class="o">-</span><span class="n">east</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="n">us</span><span class="o">-</span><span class="n">east</span><span class="o">-</span><span class="mi">1</span><span class="n">a</span><span class="o">-</span><span class="mi">0</span>   <span class="n">ClusterIP</span>   <span class="mf">10.43.23.96</span>    <span class="o">&lt;</span><span class="n">none</span><span class="o">&gt;</span>        <span class="mi">7000</span><span class="o">/</span><span class="n">TCP</span><span class="p">,</span><span class="mi">7001</span><span class="o">/</span><span class="n">TCP</span><span class="p">,</span><span class="mi">7199</span><span class="o">/</span><span class="n">TCP</span><span class="p">,</span><span class="mi">10001</span><span class="o">/</span><span class="n">TCP</span><span class="p">,</span><span class="mi">9042</span><span class="o">/</span><span class="n">TCP</span><span class="p">,</span><span class="mi">9142</span><span class="o">/</span><span class="n">TCP</span><span class="p">,</span><span class="mi">9160</span><span class="o">/</span><span class="n">TCP</span>   <span class="mi">109</span><span class="n">m</span>
 <span class="n">simple</span><span class="o">-</span><span class="n">cluster</span><span class="o">-</span><span class="n">us</span><span class="o">-</span><span class="n">east</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="n">us</span><span class="o">-</span><span class="n">east</span><span class="o">-</span><span class="mi">1</span><span class="n">a</span><span class="o">-</span><span class="mi">1</span>   <span class="n">ClusterIP</span>   <span class="mf">10.43.66.22</span>    <span class="o">&lt;</span><span class="n">none</span><span class="o">&gt;</span>        <span class="mi">7000</span><span class="o">/</span><span class="n">TCP</span><span class="p">,</span><span class="mi">7001</span><span class="o">/</span><span class="n">TCP</span><span class="p">,</span><span class="mi">7199</span><span class="o">/</span><span class="n">TCP</span><span class="p">,</span><span class="mi">10001</span><span class="o">/</span><span class="n">TCP</span><span class="p">,</span><span class="mi">9042</span><span class="o">/</span><span class="n">TCP</span><span class="p">,</span><span class="mi">9142</span><span class="o">/</span><span class="n">TCP</span><span class="p">,</span><span class="mi">9160</span><span class="o">/</span><span class="n">TCP</span>   <span class="mi">108</span><span class="n">m</span>
 <span class="n">simple</span><span class="o">-</span><span class="n">cluster</span><span class="o">-</span><span class="n">us</span><span class="o">-</span><span class="n">east</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="n">us</span><span class="o">-</span><span class="n">east</span><span class="o">-</span><span class="mi">1</span><span class="n">a</span><span class="o">-</span><span class="mi">2</span>   <span class="n">ClusterIP</span>   <span class="mf">10.43.246.25</span>   <span class="o">&lt;</span><span class="n">none</span><span class="o">&gt;</span>        <span class="mi">7000</span><span class="o">/</span><span class="n">TCP</span><span class="p">,</span><span class="mi">7001</span><span class="o">/</span><span class="n">TCP</span><span class="p">,</span><span class="mi">7199</span><span class="o">/</span><span class="n">TCP</span><span class="p">,</span><span class="mi">10001</span><span class="o">/</span><span class="n">TCP</span><span class="p">,</span><span class="mi">9042</span><span class="o">/</span><span class="n">TCP</span><span class="p">,</span><span class="mi">9142</span><span class="o">/</span><span class="n">TCP</span><span class="p">,</span><span class="mi">9160</span><span class="o">/</span><span class="n">TCP</span>   <span class="mi">106</span><span class="n">m</span>
</pre></div>
</div>
</li>
<li><p>For each service, change its <code class="docutils literal notranslate"><span class="pre">ownerReference</span></code> to point to new CRD instance:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span> <span class="n">kubectl</span> <span class="o">-</span><span class="n">n</span> <span class="n">scylla</span> <span class="n">patch</span> <span class="n">svc</span> <span class="o">&lt;</span><span class="n">cluster</span><span class="o">-</span><span class="n">svc</span><span class="o">-</span><span class="n">name</span><span class="o">&gt;</span> <span class="o">--</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;json&#39;</span> <span class="o">-</span><span class="n">p</span><span class="o">=</span><span class="s1">&#39;[{&quot;op&quot;: &quot;replace&quot;, &quot;path&quot;: &quot;/metadata/ownerReferences/0/apiVersion&quot;, &quot;value&quot;:&quot;scylla.scylladb.com/v1&quot;}, {&quot;op&quot;: &quot;replace&quot;, &quot;path&quot;: &quot;/metadata/ownerReferences/0/kind&quot;, &quot;value&quot;:&quot;ScyllaCluster&quot;}, {&quot;op&quot;: &quot;replace&quot;, &quot;path&quot;: &quot;/metadata/ownerReferences/0/uid&quot;, &quot;value&quot;:&quot;&lt;new-cluster-uid&gt;&quot;}]&#39;</span>
</pre></div>
</div>
<p>Replace <code class="docutils literal notranslate"><span class="pre">&lt;cluster-svc-name&gt;</span></code> with Service name, and <code class="docutils literal notranslate"><span class="pre">&lt;new-cluster-uid&gt;</span></code> with saved UUID from one of the previous steps.</p>
</li>
<li><p>Get a list of all Services again to see if none was deleted. Check also “Age” column, it shouldn’t be lower than previous result.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span> <span class="n">kubectl</span> <span class="o">-</span><span class="n">n</span> <span class="n">scylla</span> <span class="n">get</span> <span class="n">svc</span> <span class="o">-</span><span class="n">l</span> <span class="s2">&quot;scylla/cluster=simple-cluster&quot;</span>

 <span class="n">NAME</span>                                    <span class="n">TYPE</span>        <span class="n">CLUSTER</span><span class="o">-</span><span class="n">IP</span>     <span class="n">EXTERNAL</span><span class="o">-</span><span class="n">IP</span>   <span class="n">PORT</span><span class="p">(</span><span class="n">S</span><span class="p">)</span>                                                           <span class="n">AGE</span>
 <span class="n">simple</span><span class="o">-</span><span class="n">cluster</span><span class="o">-</span><span class="n">client</span>                   <span class="n">ClusterIP</span>   <span class="kc">None</span>           <span class="o">&lt;</span><span class="n">none</span><span class="o">&gt;</span>        <span class="mi">9180</span><span class="o">/</span><span class="n">TCP</span>                                                          <span class="mi">110</span><span class="n">m</span>
 <span class="n">simple</span><span class="o">-</span><span class="n">cluster</span><span class="o">-</span><span class="n">us</span><span class="o">-</span><span class="n">east</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="n">us</span><span class="o">-</span><span class="n">east</span><span class="o">-</span><span class="mi">1</span><span class="n">a</span><span class="o">-</span><span class="mi">0</span>   <span class="n">ClusterIP</span>   <span class="mf">10.43.23.96</span>    <span class="o">&lt;</span><span class="n">none</span><span class="o">&gt;</span>        <span class="mi">7000</span><span class="o">/</span><span class="n">TCP</span><span class="p">,</span><span class="mi">7001</span><span class="o">/</span><span class="n">TCP</span><span class="p">,</span><span class="mi">7199</span><span class="o">/</span><span class="n">TCP</span><span class="p">,</span><span class="mi">10001</span><span class="o">/</span><span class="n">TCP</span><span class="p">,</span><span class="mi">9042</span><span class="o">/</span><span class="n">TCP</span><span class="p">,</span><span class="mi">9142</span><span class="o">/</span><span class="n">TCP</span><span class="p">,</span><span class="mi">9160</span><span class="o">/</span><span class="n">TCP</span>   <span class="mi">110</span><span class="n">m</span>
 <span class="n">simple</span><span class="o">-</span><span class="n">cluster</span><span class="o">-</span><span class="n">us</span><span class="o">-</span><span class="n">east</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="n">us</span><span class="o">-</span><span class="n">east</span><span class="o">-</span><span class="mi">1</span><span class="n">a</span><span class="o">-</span><span class="mi">1</span>   <span class="n">ClusterIP</span>   <span class="mf">10.43.66.22</span>    <span class="o">&lt;</span><span class="n">none</span><span class="o">&gt;</span>        <span class="mi">7000</span><span class="o">/</span><span class="n">TCP</span><span class="p">,</span><span class="mi">7001</span><span class="o">/</span><span class="n">TCP</span><span class="p">,</span><span class="mi">7199</span><span class="o">/</span><span class="n">TCP</span><span class="p">,</span><span class="mi">10001</span><span class="o">/</span><span class="n">TCP</span><span class="p">,</span><span class="mi">9042</span><span class="o">/</span><span class="n">TCP</span><span class="p">,</span><span class="mi">9142</span><span class="o">/</span><span class="n">TCP</span><span class="p">,</span><span class="mi">9160</span><span class="o">/</span><span class="n">TCP</span>   <span class="mi">109</span><span class="n">m</span>
 <span class="n">simple</span><span class="o">-</span><span class="n">cluster</span><span class="o">-</span><span class="n">us</span><span class="o">-</span><span class="n">east</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="n">us</span><span class="o">-</span><span class="n">east</span><span class="o">-</span><span class="mi">1</span><span class="n">a</span><span class="o">-</span><span class="mi">2</span>   <span class="n">ClusterIP</span>   <span class="mf">10.43.246.25</span>   <span class="o">&lt;</span><span class="n">none</span><span class="o">&gt;</span>        <span class="mi">7000</span><span class="o">/</span><span class="n">TCP</span><span class="p">,</span><span class="mi">7001</span><span class="o">/</span><span class="n">TCP</span><span class="p">,</span><span class="mi">7199</span><span class="o">/</span><span class="n">TCP</span><span class="p">,</span><span class="mi">10001</span><span class="o">/</span><span class="n">TCP</span><span class="p">,</span><span class="mi">9042</span><span class="o">/</span><span class="n">TCP</span><span class="p">,</span><span class="mi">9142</span><span class="o">/</span><span class="n">TCP</span><span class="p">,</span><span class="mi">9160</span><span class="o">/</span><span class="n">TCP</span>   <span class="mi">107</span><span class="n">m</span>
</pre></div>
</div>
</li>
<li><p>Get a list of StatefulSets associated with your cluster:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">kubectl</span> <span class="o">-</span><span class="n">n</span> <span class="n">scylla</span> <span class="n">get</span> <span class="n">sts</span> <span class="o">-</span><span class="n">l</span> <span class="s2">&quot;scylla/cluster=simple-cluster&quot;</span>

<span class="n">NAME</span>                                  <span class="n">READY</span>   <span class="n">AGE</span>
<span class="n">simple</span><span class="o">-</span><span class="n">cluster</span><span class="o">-</span><span class="n">us</span><span class="o">-</span><span class="n">east</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="n">us</span><span class="o">-</span><span class="n">east</span><span class="o">-</span><span class="mi">1</span><span class="n">a</span>   <span class="mi">3</span><span class="o">/</span><span class="mi">3</span>     <span class="mi">104</span><span class="n">m</span>
</pre></div>
</div>
</li>
<li><p>For each StatefulSet from previous step, change its <code class="docutils literal notranslate"><span class="pre">ownerReference</span></code> to point to new CRD instance.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span> <span class="n">kubectl</span> <span class="o">-</span><span class="n">n</span> <span class="n">scylla</span> <span class="n">patch</span> <span class="n">sts</span> <span class="o">&lt;</span><span class="n">cluster</span><span class="o">-</span><span class="n">sts</span><span class="o">-</span><span class="n">name</span><span class="o">&gt;</span> <span class="o">--</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;json&#39;</span> <span class="o">-</span><span class="n">p</span><span class="o">=</span><span class="s1">&#39;[{&quot;op&quot;: &quot;replace&quot;, &quot;path&quot;: &quot;/metadata/ownerReferences/0/apiVersion&quot;, &quot;value&quot;:&quot;scylla.scylladb.com/v1&quot;}, {&quot;op&quot;: &quot;replace&quot;, &quot;path&quot;: &quot;/metadata/ownerReferences/0/kind&quot;, &quot;value&quot;:&quot;ScyllaCluster&quot;}, {&quot;op&quot;: &quot;replace&quot;, &quot;path&quot;: &quot;/metadata/ownerReferences/0/uid&quot;, &quot;value&quot;:&quot;&lt;new-cluster-uid&gt;&quot;}]&#39;</span>
</pre></div>
</div>
<p>Replace <code class="docutils literal notranslate"><span class="pre">&lt;cluster-sts-name&gt;</span></code> with StatefulSet name, and <code class="docutils literal notranslate"><span class="pre">&lt;new-cluster-uid&gt;</span></code> with saved UUID from one of the previous steps.</p>
</li>
<li><p>Now when all k8s resources bound to Scylla are attached to new CRD, we can remove 0.3.0 Operator and old CRD definition.
Checkout <code class="docutils literal notranslate"><span class="pre">v0.3.0</span></code> version, and remove Scylla Operator, and old CRD:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span> <span class="n">git</span> <span class="n">checkout</span> <span class="n">v0</span><span class="mf">.3.0</span>
 <span class="n">kubectl</span> <span class="n">delete</span> <span class="o">-</span><span class="n">f</span> <span class="n">examples</span><span class="o">/</span><span class="n">generic</span><span class="o">/</span><span class="n">operator</span><span class="o">.</span><span class="n">yaml</span>
</pre></div>
</div>
</li>
<li><p>Checkout <code class="docutils literal notranslate"><span class="pre">v1.0.0</span></code>, and install upgraded Scylla Operator:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span> <span class="n">git</span> <span class="n">checkout</span> <span class="n">v1</span><span class="mf">.0.0</span>
 <span class="n">kubectl</span> <span class="n">apply</span> <span class="o">-</span><span class="n">f</span> <span class="n">examples</span><span class="o">/</span><span class="n">common</span><span class="o">/</span><span class="n">operator</span><span class="o">.</span><span class="n">yaml</span>
</pre></div>
</div>
</li>
<li><p>Wait until Scylla Operator boots up:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span> <span class="n">kubectl</span> <span class="o">-</span><span class="n">n</span> <span class="n">scylla</span><span class="o">-</span><span class="n">operator</span><span class="o">-</span><span class="n">system</span> <span class="n">wait</span> <span class="o">--</span><span class="k">for</span><span class="o">=</span><span class="n">condition</span><span class="o">=</span><span class="n">ready</span> <span class="n">pod</span> <span class="o">--</span><span class="nb">all</span> <span class="o">--</span><span class="n">timeout</span><span class="o">=</span><span class="mi">600</span><span class="n">s</span>
</pre></div>
</div>
</li>
<li><p>Get a list of StatefulSets associated with your cluster:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">kubectl</span> <span class="o">-</span><span class="n">n</span> <span class="n">scylla</span> <span class="n">get</span> <span class="n">sts</span> <span class="o">-</span><span class="n">l</span> <span class="s2">&quot;scylla/cluster=simple-cluster&quot;</span>

<span class="n">NAME</span>                                  <span class="n">READY</span>   <span class="n">AGE</span>
<span class="n">simple</span><span class="o">-</span><span class="n">cluster</span><span class="o">-</span><span class="n">us</span><span class="o">-</span><span class="n">east</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="n">us</span><span class="o">-</span><span class="n">east</span><span class="o">-</span><span class="mi">1</span><span class="n">a</span>   <span class="mi">3</span><span class="o">/</span><span class="mi">3</span>     <span class="mi">104</span><span class="n">m</span>
</pre></div>
</div>
</li>
<li><p>For each StatefulSet from previous step, change its sidecar container image to <code class="docutils literal notranslate"><span class="pre">v1.0.0</span></code>, and wait until change will be propagated. This step will initiate a rolling restart of pods one by one.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">kubectl</span> <span class="o">-</span><span class="n">n</span> <span class="n">scylla</span> <span class="n">patch</span> <span class="n">sts</span> <span class="o">&lt;</span><span class="n">cluster</span><span class="o">-</span><span class="n">sts</span><span class="o">&gt;</span> <span class="o">--</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;json&#39;</span> <span class="o">-</span><span class="n">p</span><span class="o">=</span><span class="s1">&#39;[{&quot;op&quot;: &quot;replace&quot;, &quot;path&quot;: &quot;/spec/template/spec/initContainers/0/image&quot;, &quot;value&quot;:&quot;scylladb/scylla-operator:v1.0.0&quot;}]&#39;</span>
<span class="n">kubectl</span> <span class="o">-</span><span class="n">n</span> <span class="n">scylla</span> <span class="n">rollout</span> <span class="n">status</span> <span class="n">sts</span> <span class="o">&lt;</span><span class="n">cluster</span><span class="o">-</span><span class="n">sts</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Replace <code class="docutils literal notranslate"><span class="pre">&lt;cluster-sts-name&gt;</span></code> with StatefulSet name.</p>
</li>
<li><p>If you’re using Scylla Manager, bump Scylla Manager Controller image to <code class="docutils literal notranslate"><span class="pre">v1.0.0</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span> <span class="n">kubectl</span> <span class="o">-</span><span class="n">n</span> <span class="n">scylla</span><span class="o">-</span><span class="n">manager</span><span class="o">-</span><span class="n">system</span> <span class="n">patch</span> <span class="n">sts</span> <span class="n">scylla</span><span class="o">-</span><span class="n">manager</span><span class="o">-</span><span class="n">controller</span> <span class="o">--</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;json&#39;</span> <span class="o">-</span><span class="n">p</span><span class="o">=</span><span class="s1">&#39;[{&quot;op&quot;: &quot;replace&quot;, &quot;path&quot;: &quot;/spec/template/spec/containers/0/image&quot;, &quot;value&quot;:&quot;scylladb/scylla-operator:v1.0.0&quot;}]&#39;</span>
</pre></div>
</div>
</li>
<li><p>Your Scylla cluster is now migrated to <code class="docutils literal notranslate"><span class="pre">v1.0.0</span></code>.</p></li>
</ol>
</section>
</section>

                
                    <div class="post-content">
                        <div class="content-navigation">
    <div class="navigation navigation--prev">
        
            <a class="navigation__link" href="monitoring.html">
                <button class="navigation__button">
                    <i class="scylla-icon scylla-icon--chevron-left"></i>
                </button>
                <div class="navigation__title">
                    <span class="colored">PREVIOUS</span> <br />Monitoring
                </div>
            </a>
        
    </div>
    <div class="navigation navigation--next">
        
            <a class="navigation__link" href="nodeoperations/index.html">
                <div class="navigation__title">
                    <span class="colored">NEXT</span> <br />Node operations using Scylla Operator
                </div>
                <button class="navigation__button">
                    <i class="scylla-icon scylla-icon--chevron-right"></i>
                </button>
            </a>
        
    </div>
</div>
                        <!-- Post content text -->
                    </div>
                
            </div>
            <div class="sidebar-left  large-order-1">
                
                    
                        <div id="side-nav" class="side-nav custom-scroll-bar" data-closable data-toggler=".show">
    <button class="collapsible-button">
        <i class="scylla-icon scylla-icon--chevron-left"></i>
    </button>
    <div class="side-nav-content">
        <div class="side-nav__search">
            <div class="search-box">
                <ci-search></ci-search>
            </div>
        </div>
        <div class="side-nav__title">
            Scylla Operator
        </div>
        <div class="side-nav__versions"><ul class="dropdown menu scylla-dropdown scylla-dropdown--versions" data-dropdown-menu>
    <li class="scylla-dropdown__item">
        <a class="scylla-dropdown__title" href="#">
            
                master
            
            <i class="chevron scylla-icon scylla-icon--chevron-right"></i>
        </a>
        <ul class="menu scylla-dropdown__content">
            
                
                    <li>
                        <a href="migration.html">master</a>
                    </li>
                
            
            
        </ul>
    </li>
</ul></div>
        <div class="side-nav__content">
            <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="generic.html">Deploying Scylla on a Kubernetes Cluster</a></li>
<li class="toctree-l1"><a class="reference internal" href="eks.html">Deploying Scylla on EKS</a></li>
<li class="toctree-l1"><a class="reference internal" href="gke.html">Deploying Scylla on GKE</a></li>
<li class="toctree-l1"><a class="reference internal" href="helm.html">Deploying Scylla stack using Helm Charts</a></li>
<li class="toctree-l1"><a class="reference internal" href="manager.html">Deploying Scylla Manager on a Kubernetes Cluster</a></li>
<li class="toctree-l1"><a class="reference internal" href="monitoring.html">Monitoring</a></li>
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">Version  migrations</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="nodeoperations/index.html">Node operations using Scylla Operator</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label for="toctree-checkbox-1"><i class="scylla-icon scylla-icon--expand"></i></label><div class="break"></div><ul>
<li class="toctree-l2"><a class="reference internal" href="nodeoperations/scylla_upgrade.html">Upgrading version of Scylla</a></li>
<li class="toctree-l2"><a class="reference internal" href="nodeoperations/replace_node.html">Replacing a Scylla node</a></li>
<li class="toctree-l2"><a class="reference internal" href="nodeoperations/automatic_cleanup.html">Automatic cleanup and replacement in case when k8s node is lost</a></li>
<li class="toctree-l2"><a class="reference internal" href="nodeoperations/maintenance_mode.html">Maintenance mode</a></li>
<li class="toctree-l2"><a class="reference internal" href="nodeoperations/restore.html">Restore from backup</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="performance.html">Performance tuning</a></li>
<li class="toctree-l1"><a class="reference internal" href="upgrade.html">Upgrade of Scylla Operator</a></li>
<li class="toctree-l1"><a class="reference internal" href="releases.html">Releases</a></li>
<li class="toctree-l1"><a class="reference internal" href="known_issues.html">Known issues</a></li>
<li class="toctree-l1"><a class="reference internal" href="scylla_cluster_crd.html">Scylla Cluster CRD</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributing.html">Contributing to Scylla Operator</a></li>
</ul>

        </div>
    </div>
</div>
                    
                
            </div>
            
                <div class="sidebar-right large-order-3">
                    <div class="secondary-side-nav custom-scroll-bar">
    
    <ul class="contribute">
        <li class="contribute__item">
            <a href="https://github.com/scylladb/scylla-operator/issues/new?title=docs:%20Issue in page Version migrations&&body=I%20would%20like%20to%20report%20an%20issue%20in%20page%20https://operator.docs.scylladb.com/master/migration%0A%0A%23%23%23%20Problem%0A%0A%23%23%23%20%20Suggest%20a%20fix&labels=documentation"
                target="_blank">
                <i class="icon fab fa-github" aria-hidden="true"></i>Create an issue
            </a>
        </li>
        
            <li class="contribute__item">
                <a href="https://github.com/scylladb/scylla-operator/edit/master/docs/source/migration.md"
                    target="_blank">
                    <i class="icon fa fa-edit" aria-hidden="true"></i>Edit this page
                </a>
            </li>
        
    </ul>

    
        <div class="secondary-side-nav__content">
            <p class="topic-title">On this page</p>
            <ul>
<li><a class="reference internal" href="#">Version  migrations</a><ul>
<li><a class="reference internal" href="#v0-3-0-v1-0-0-migration"><code class="docutils literal notranslate"><span class="pre">v0.3.0</span></code> -&gt; <code class="docutils literal notranslate"><span class="pre">v1.0.0</span></code> migration</a></li>
<li><a class="reference internal" href="#procedure">Procedure</a></li>
</ul>
</li>
</ul>

        </div>
    
</div>
                </div>
            
        </section>

        <footer class="footer">
    <div class="footer-group">
        <div class="footer-top">
            <a class="footer-logo" href="https://www.scylladb.com">
                <img src="_static/img/logo-scylla-horizontal-RGB.svg" alt="Logo" />
            </a>
            <div class="footer-links">
                <a class="footer-links__link" href="https://docs.scylladb.com/">Docs</a>
                <a class="footer-links__link" href="https://www.scylladb.com/company/contact-us/">Contact Us</a>
                <a class="footer-links__link" href="https://www.scylladb.com/company/">About Us</a>
            </div>
            <div class="footer-actions">
                <a class="footer-actions__link" href="https://groups.google.com/g/scylladb-users" target="_blank">
                    <span data-tooltip tabindex="1" title="User mailing list" data-position="bottom">
                        <img src="_static/img/icons/icon-mail-list.svg" alt="Mail List Icon" />
                    </span>
                </a>
                <a class="footer-actions__link" href="http://slack.scylladb.com/" target="_blank">
                    <span data-tooltip tabindex="1" title="User Slack channel" data-position="bottom">
                        <img src="_static/img/icons/icon-slack.svg" alt="Slack Icon" />
                    </span>
                </a>
                <a class="footer-actions__link" href="https://forum.scylladb.com/" target="_blank">
                    <span data-tooltip tabindex="1" title="Community forum" data-position="bottom">
                        <img src="_static/img/icons/icon-forum.svg" alt="Forum Icon" />
                    </span>
                </a>
            </div>
        </div>

        <div class="footer-bottom">
            
                <div class="footer-bottom__copyright">
                    
                        
                            &#169; 2023, ScyllaDB. All rights reserved.
                        
                    
                </div>
            
            
                <div class="footer-bottom__last-updated">
                    
                        Last updated on 18 May 2023.
                    
                </div>
            
            <div class="footer-bottom__version">
                Powered by
                <a href="http://sphinx-doc.org/">Sphinx 4.5.0</a> &amp;
                <a href="https://sphinx-theme.scylladb.com/">ScyllaDB Theme 1.3.5</a>
            </div>
        </div>
    </div>
</footer>

        <noscript>
            <iframe src="https://www.googletagmanager.com/ns.html?id=GTM-T8P2JP" height="0" width="0"
                style="display: none; visibility: hidden"></iframe>
        </noscript>
    </body>

</html>