

<!DOCTYPE html>
<html class="no-js" lang="en">
    
    

    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width initial-scale=1" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <title>
             Deploying Scylla Manager on a Kubernetes Cluster | ScyllaDB Docs 
        </title>
        <meta name="description" content="ScyllaDB is an Apache Cassandra-compatible NoSQL data store that can handle 1 million transactions per second on a single server." />
        <link rel="icon" href="_static/img/favicon.ico" type="image/x-icon" />
        <link rel="icon" href="_static/img/favicon-32x32.png" sizes="32x32" />
        <link rel="icon" href="_static/img/favicon-228x228.png" sizes="192x192" />
        <link rel="apple-touch-icon" href="_static/img/favicon-228x228.png" />
        <meta name="msapplication-TileImage" href="_static/img/favicon-228x228.png" />

        
            
            
        

        
            <link rel="canonical" href="https://operator.docs.scylladb.com/manager.html"/>
        

        <link rel="author" href="mailto:info@scylladb.com" />

        
            
        <!-- increase expertrec loading priority-->
        <link rel="dns-prefetch" href="https://cse.expertrec.com">

        <!-- increase font loading priority -->
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
        <link rel="preload" as="style"
            href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,400;0,500;0,700;1,400&display=swap" />

        <!-- async CSS -->
        <link rel="stylesheet" media="print" onload="this.onload=null;this.removeAttribute('media');"
            href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,400;0,500;0,700;1,400&display=swap" />

        <!-- no-JS fallback -->
        <noscript>
            <link rel="stylesheet"
                href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,400;0,500;0,700;1,400&display=swap" />
        </noscript>
        
            
                <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
            
        
            
                <link rel="stylesheet" type="text/css" href="_static/css/main.css" />
            
        
            
                <link rel="stylesheet" type="text/css" href="_static/sphinx_collapse.css" />
            
        
            
                <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
            
        
    
        
        
            

        <script type="text/javascript" id="documentation_options" data-url_root="./"
            src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/js/runtime.bundle.js"></script>
        <script type="text/javascript" src="_static/js/main.bundle.js"></script>
        
            
                <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
            
        
            
        
            
                <script src="_static/underscore.js"></script>
            
        
            
                <script src="_static/doctools.js"></script>
            
        
            
                <script src="_static/clipboard.min.js"></script>
            
        
            
                <script src="_static/copybutton.js"></script>
            
        
    
            <!- Zendesk tag -->
<meta name='zd-site-verification' content='gq6ltsh3nfex3cnwfy4aj9' />
<!-- Google Tag Manager -->
<script>
    (function (w, d, s, l, i) {
        w[l] = w[l] || [];
        w[l].push({
            "gtm.start": new Date().getTime(),
            event: "gtm.js"
        });
        var f = d.getElementsByTagName(s)[0],
        j = d.createElement(s),
        dl = l != "dataLayer" ? "&l=" + l : "";
        j.async = true;
        j.src = "https://www.googletagmanager.com/gtm.js?id=" + i + dl;
        f.parentNode.insertBefore(j, f);
    })(window, document, "script", "dataLayer", "GTM-T8P2JP");
</script>
<!-- End Google Tag Manager -->

<!-- Expertrec -->
<script>
    var id = "e2077224-9ccf-11e9-a0c9-0242ac130002";
    var ci_search = document.createElement("script");
    ci_search.type = "text/javascript";
    ci_search.async = true;
    ci_search.src = "https://cse.expertrec.com/api/js/ci_common.js?id=" + id;
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(ci_search, s);
</script>
<!-- End Expertrec -->
        
        <!-- Font Awesome -->
        <script src="https://kit.fontawesome.com/b1870adf6a.js" crossorigin="anonymous"></script>
        <!-- End Font Awesome -->
    </head>

    <body>
        
        <header class="header">
    <div class="header-logo">
        <a class="header-logo__img" href="https://scylladb.com/">
            <img src="_static/img/logo-docs.svg" alt="ScyllaDB Documentation Logo" />
        </a>
        <span class="header-logo__bar"></span>
        <a class="header-logo__text" href="https://docs.scylladb.com/">
            Documentation
        </a>
    </div>
    <div class="header-navigation">
        <ul class="dropdown menu scylla-dropdown scylla-dropdown--header" data-dropdown-menu>
            <li class="scylla-dropdown__item">
                <a href="#" class="scylla-dropdown__title">Server
                    <i class="chevron scylla-icon scylla-icon--triangle-down"></i></a>
                <ul class="menu scylla-dropdown__content">
                    <li>
                        <a href="https://docs.scylladb.com/">
                            <i class="scylla-icon scylla-icon--about-us"></i>
                            ScyllaDB Open Source
                        </a>
                    </li>
                    <li>
                        <a href="https://enterprise.docs.scylladb.com/">
                            <i class="scylla-icon scylla-icon--enterprise"></i>ScyllaDB Enterprise
                        </a>
                    </li>
                    <li>
                        <a href="https://scylla.docs.scylladb.com/stable/alternator/alternator.html">
                            <i class="scylla-icon scylla-icon--overview"></i>
                            ScyllaDB Alternator
                        </a>
                    </li>
                </ul>
            </li>
            <li class="scylla-dropdown__item">
                <a href="https://docs.scylladb.com/scylla-cloud/" class="scylla-dropdown__title">Cloud</a>
            </li>
            <li class="scylla-dropdown__item">
                <a href="#" class="scylla-dropdown__title">Tools <i
                    class="chevron scylla-icon scylla-icon--triangle-down"></i></a>
                <ul class="menu scylla-dropdown__content">
                    <li>
                        <a href="https://manager.docs.scylladb.com/">
                            <i class="scylla-icon scylla-icon--manager"></i>ScyllaDB Manager</a>
                    </li>
                    <li>
                        <a href="https://monitoring.docs.scylladb.com/">
                            <i class="scylla-icon scylla-icon--monitoring"></i>ScyllaDB
                            Monitoring Stack</a>
                    </li>
                    <li>
                        <a href="https://operator.docs.scylladb.com/">
                            <i class="scylla-icon scylla-icon--operator"></i>ScyllaDB Operator
                        </a>
                    </li>
                </ul>
            </li>
            <li class="scylla-dropdown__item">
                <a href="#" class="scylla-dropdown__title">Drivers <i
                    class="chevron scylla-icon scylla-icon--triangle-down"></i></a>
                <ul class="menu scylla-dropdown__content">
                    <li>
                        <a href="https://docs.scylladb.com/using-scylla/drivers/cql-drivers/">
                            <i class="scylla-icon scylla-icon--nsql-guides"></i>CQL Drivers
                        </a>
                    </li>
                    <li>
                        <a href="https://docs.scylladb.com/using-scylla/drivers/dynamo-drivers/">
                            <i class="scylla-icon scylla-icon--overview"></i>DynamoDB Drivers
                        </a>
                    </li>
                </ul>
            </li>
        </ul>
        <div class="header-button">
            <a href="https://www.scylladb.com/download/" class="button">Download</a>
        </div>
    </div>
    <div class="header-search-box">
        <div class="search-box">
            <ci-search></ci-search>
        </div>
    </div>
    <div class="side-nav-toggle" data-toggle="side-nav">
    <div class="side-nav-toggle__button">
        <img src="_static/img/menu.svg" alt="Menu" />
    </div>
</div>
</header>
        <section
            class="layout  layout--sidebar layout--has-secondary-sidebar ">
            <div class="content large-order-2">
                
                    
                
                
                    <div class="pre-content">
                        <div class="breadcrumbs">
    <span class="bread__item">
        <a href="https://docs.scylladb.com"
            class="bread__highlight">
            <i class="fas fa-home"></i> ScyllaDB Docs
        </a>
    </span>
    <span class="bread__item">
        <a href="index.html"
            class="bread__highlight">
            Scylla Operator
        </a>
    </span>
    
    <span class="bread__item bread__item--last">Deploying Scylla Manager on a Kubernetes Cluster</span>
</div>
                    </div>
                
                <section id="deploying-scylla-manager-on-a-kubernetes-cluster">
<h1>Deploying Scylla Manager on a Kubernetes Cluster<a class="headerlink" href="#deploying-scylla-manager-on-a-kubernetes-cluster" title="Permalink to this headline">¶</a></h1>
<p>Scylla Manager is a product for database operations automation,
it can schedule tasks such as repairs and backups.
Scylla Manager can manage multiple Scylla clusters and run cluster-wide tasks
in a controlled and predictable way.</p>
<p>Scylla Manager is available for Scylla Enterprise customers and Scylla Open Source users.
With Scylla Open Source, Scylla Manager is limited to 5 nodes.
See the Scylla Manager <a class="reference external" href="https://www.scylladb.com/scylla-manager-software-license-agreement/">Proprietary Software License Agreement</a> for details.</p>
<section id="prerequisites">
<h2>Prerequisites<a class="headerlink" href="#prerequisites" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Kubernetes cluster</p></li>
<li><p>Scylla Operator - see <a class="reference internal" href="generic.html"><span class="doc">generic guide</span></a></p></li>
</ul>
</section>
<section id="architecture">
<h2>Architecture<a class="headerlink" href="#architecture" title="Permalink to this headline">¶</a></h2>
<p>Scylla Manager in K8s consist of:</p>
<ul>
<li><p>Dedicated Scylla Cluster</p>
<p>Scylla Manager persists its state to a Scylla cluster.
Additional small single node cluster is spawned in the Manager namespace.</p>
</li>
<li><p>Scylla Manager Controller</p>
<p>Main mission of Controller is to watch changes of Scylla Clusters, and synchronize three states.</p>
<ol class="simple">
<li><p>What user wants - task definition in CRD.</p></li>
<li><p>What Controller registered - Task name to Task ID mapping - CRD status.</p></li>
<li><p>Scylla Manager task listing - internal state of Scylla Manager.</p></li>
</ol>
<p>When Scylla Cluster CRD is being deployed Controller will register it in Scylla Manager once cluster reaches desired node count.
Once Cluster is fully up and running it will schedule all tasks defined in Cluster CRD.
Controller also supports task updates and unscheduling.</p>
</li>
<li><p>Scylla Manager</p>
<p>Regular Scylla Manager, the same used in cloud and bare metal deployments.</p>
</li>
</ul>
</section>
<section id="deploy-scylla-manager">
<h2>Deploy Scylla Manager<a class="headerlink" href="#deploy-scylla-manager" title="Permalink to this headline">¶</a></h2>
<p>Deploy the Scylla Manager using the following commands:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">kubectl apply -f examples/common/manager.yaml</span>
</pre></div>
</div>
<p>This will install the Scylla Manager in the <code class="docutils literal notranslate"><span class="pre">scylla-manager</span></code> namespace.
You can check if the Scylla Manager is up and running with:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">kubectl -n scylla-manager get pods</span>
<span class="go">NAME                                               READY   STATUS    RESTARTS   AGE</span>
<span class="go">scylla-manager-cluster-manager-dc-manager-rack-0   2/2     Running   0          37m</span>
<span class="go">scylla-manager-controller-0                        1/1     Running   0          28m</span>
<span class="go">scylla-manager-scylla-manager-7bd9f968b9-w25jw     1/1     Running   0          37m</span>
</pre></div>
</div>
<p>As you can see there are three pods:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">scylla-manager-cluster-manager-dc-manager-rack-0</span></code> - is a single node Scylla cluster.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">scylla-manager-controller-0</span></code> - Scylla Manager Controller.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">scylla-manager-scylla-manager-7bd9f968b9-w25jw</span></code> - Scylla Manager.</p></li>
</ul>
<p>To see if Scylla Manager is fully up and running we can check their logs.
To do this, execute following command:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">kubectl -n scylla-manager logs scylla-manager-controller-0</span>
</pre></div>
</div>
<p>The output should be something like:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">{&quot;L&quot;:&quot;INFO&quot;,&quot;T&quot;:&quot;2020-09-23T11:25:27.882Z&quot;,&quot;M&quot;:&quot;Scylla Manager Controller started&quot;,&quot;version&quot;:&quot;&quot;,&quot;build_date&quot;:&quot;&quot;,&quot;commit&quot;:&quot;&quot;,&quot;built_by&quot;:&quot;&quot;,&quot;go_version&quot;:&quot;&quot;,&quot;options&quot;:{&quot;Name&quot;:&quot;scylla-manager-controller-0&quot;,&quot;Namespace&quot;:&quot;scylla-manager&quot;,&quot;LogLevel&quot;:&quot;debug&quot;,&quot;ApiAddress&quot;:&quot;http://127.0.0.1:5080/api/v1&quot;},&quot;_trace_id&quot;:&quot;LQEJV3kDR5Gx9M3XQ2YnnQ&quot;}</span>
<span class="go">{&quot;L&quot;:&quot;INFO&quot;,&quot;T&quot;:&quot;2020-09-23T11:25:28.435Z&quot;,&quot;M&quot;:&quot;Registering Components.&quot;,&quot;_trace_id&quot;:&quot;LQEJV3kDR5Gx9M3XQ2YnnQ&quot;}</span>
</pre></div>
</div>
<p>To check logs of Scylla Manager itself, use following command:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">kubectl -n scylla-manager logs scylla-manager-scylla-manager-7bd9f968b9-w25jw</span>
</pre></div>
</div>
<p>The output should be something like:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">{&quot;L&quot;:&quot;INFO&quot;,&quot;T&quot;:&quot;2020-09-23T11:26:53.238Z&quot;,&quot;M&quot;:&quot;Scylla Manager Server&quot;,&quot;version&quot;:&quot;2.1.2-0.20200816.76cc4dcc&quot;,&quot;pid&quot;:1,&quot;_trace_id&quot;:&quot;xQhkJ0OuR8e6iMDEpM62Hg&quot;}</span>
<span class="go">{&quot;L&quot;:&quot;INFO&quot;,&quot;T&quot;:&quot;2020-09-23T11:26:54.519Z&quot;,&quot;M&quot;:&quot;Using config&quot;,&quot;config&quot;:{&quot;HTTP&quot;:&quot;127.0.0.1:5080&quot;,&quot;HTTPS&quot;:&quot;&quot;,&quot;TLSCertFile&quot;:&quot;/var/lib/scylla-manager/scylla_manager.crt&quot;,&quot;TLSKeyFile&quot;:&quot;/var/lib/scylla-manager/scylla_manager.key&quot;,&quot;TLSCAFile&quot;:&quot;&quot;,&quot;Prometheus&quot;:&quot;:56090&quot;,&quot;PrometheusScrapeInterval&quot;:5000000000,&quot;debug&quot;:&quot;127.0.0.1:56112&quot;,&quot;Logger&quot;:{&quot;Mode&quot;:&quot;stderr&quot;,&quot;Level&quot;:&quot;info&quot;,&quot;Development&quot;:false},&quot;Database&quot;:{&quot;Hosts&quot;:[&quot;scylla-manager-cluster-manager-dc-manager-rack-0.scylla-manager.svc&quot;],&quot;SSL&quot;:false,&quot;User&quot;:&quot;&quot;,&quot;Password&quot;:&quot;&quot;,&quot;LocalDC&quot;:&quot;&quot;,&quot;Keyspace&quot;:&quot;scylla_manager&quot;,&quot;MigrateDir&quot;:&quot;/etc/scylla-manager/cql&quot;,&quot;MigrateTimeout&quot;:30000000000,&quot;MigrateMaxWaitSchemaAgreement&quot;:300000000000,&quot;ReplicationFactor&quot;:1,&quot;Timeout&quot;:600000000,&quot;TokenAware&quot;:true},&quot;SSL&quot;:{&quot;CertFile&quot;:&quot;&quot;,&quot;Validate&quot;:true,&quot;UserCertFile&quot;:&quot;&quot;,&quot;UserKeyFile&quot;:&quot;&quot;},&quot;Healthcheck&quot;:{&quot;Timeout&quot;:250000000,&quot;SSLTimeout&quot;:750000000},&quot;Backup&quot;:{&quot;DiskSpaceFreeMinPercent&quot;:10,&quot;AgeMax&quot;:43200000000000},&quot;Repair&quot;:{&quot;SegmentsPerRepair&quot;:1,&quot;ShardParallelMax&quot;:0,&quot;ShardFailedSegmentsMax&quot;:100,&quot;PollInterval&quot;:200000000,&quot;ErrorBackoff&quot;:300000000000,&quot;AgeMax&quot;:0,&quot;ShardingIgnoreMsbBits&quot;:12}},&quot;config_files&quot;:[&quot;/mnt/etc/scylla-manager/scylla-manager.yaml&quot;],&quot;_trace_id&quot;:&quot;xQhkJ0OuR8e6iMDEpM62Hg&quot;}</span>
<span class="go">{&quot;L&quot;:&quot;INFO&quot;,&quot;T&quot;:&quot;2020-09-23T11:26:54.519Z&quot;,&quot;M&quot;:&quot;Checking database connectivity...&quot;,&quot;_trace_id&quot;:&quot;xQhkJ0OuR8e6iMDEpM62Hg&quot;}</span>
</pre></div>
</div>
<p>If there are no errors in the logs, let’s spin a Scylla Cluster.</p>
</section>
<section id="cluster-registration">
<h2>Cluster registration<a class="headerlink" href="#cluster-registration" title="Permalink to this headline">¶</a></h2>
<p>When the Scylla Manager is fully up and running, lets create a regular instance of Scylla cluster.</p>
<p>See <a class="reference internal" href="generic.html"><span class="doc">generic tutorial</span></a> to spawn your cluster.</p>
<p>Note: If you already have some Scylla Clusters, after installing Manager they should be
automatically registered in Scylla Manager.</p>
<p>Once cluster reaches desired node count, cluster status will be updated with ID under which it was registered in Manager.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">kubectl -n scylla describe Cluster</span>

<span class="go">[...]</span>
<span class="go">Status:</span>
<span class="go"> Manager Id:  d1d532cd-49f2-4c97-9263-25126532803b</span>
<span class="go"> Racks:</span>
<span class="go">   us-east-1a:</span>
<span class="go">     Members:        3</span>
<span class="go">     Ready Members:  3</span>
<span class="go">     Version:        4.0.0</span>
</pre></div>
</div>
<p>You can use this ID to talk to Scylla Manager using <code class="docutils literal notranslate"><span class="pre">sctool</span></code> CLI installed in Scylla Manager Pod.
You can also use Cluster name in <code class="docutils literal notranslate"><span class="pre">namespace/cluster-name</span></code> format.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">kubectl -n scylla-manager exec -ti scylla-manager-scylla-manager-7bd9f968b9-w25jw -- sctool task list</span>

<span class="go">Cluster: scylla/simple-cluster (d1d532cd-49f2-4c97-9263-25126532803b)</span>
<span class="go">╭─────────────────────────────────────────────────────────────┬──────────────────────────────────────┬────────────────────────────────┬────────╮</span>
<span class="go">│ Task                                                        │ Arguments                            │ Next run                       │ Status │</span>
<span class="go">├─────────────────────────────────────────────────────────────┼──────────────────────────────────────┼────────────────────────────────┼────────┤</span>
<span class="go">│ healthcheck/400b2723-eec5-422a-b7f3-236a0e10575b            │                                      │ 23 Sep 20 14:28:42 CEST (+15s) │ DONE   │</span>
<span class="go">│ healthcheck_rest/28169610-a969-4c20-9d11-ab7568b8a1bd       │                                      │ 23 Sep 20 14:29:57 CEST (+1m)  │ NEW    │</span>
<span class="go">╰─────────────────────────────────────────────────────────────┴──────────────────────────────────────┴────────────────────────────────┴────────╯</span>
</pre></div>
</div>
<p>Scylla Manager by default registers recurring healhcheck tasks for Agent and for each of the enabled frontends (CQL, Alternator).</p>
<p>In this task listing we can see CQL and REST healthchecks.</p>
</section>
<section id="task-scheduling">
<h2>Task scheduling<a class="headerlink" href="#task-scheduling" title="Permalink to this headline">¶</a></h2>
<p>You can either define tasks prior Cluster creation, or for existing Cluster.
Let’s edit already running cluster definition to add repair and backup task.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">kubectl -n scylla edit Cluster simple-cluster</span>
</pre></div>
</div>
<p>Add following task definition to Cluster spec:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>  <span class="n">repairs</span><span class="p">:</span>
    <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="s2">&quot;users repair&quot;</span>
      <span class="n">keyspace</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;users&quot;</span><span class="p">]</span>
      <span class="n">interval</span><span class="p">:</span> <span class="s2">&quot;1d&quot;</span>
  <span class="n">backup</span><span class="p">:</span>
    <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="s2">&quot;weekly backup&quot;</span>
      <span class="n">location</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;s3:cluster-backups&quot;</span><span class="p">]</span>
      <span class="n">retention</span><span class="p">:</span> <span class="mi">3</span>
      <span class="n">interval</span><span class="p">:</span> <span class="s2">&quot;7d&quot;</span>
    <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="s2">&quot;daily backup&quot;</span>
      <span class="n">location</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;s3:cluster-backups&quot;</span><span class="p">]</span>
      <span class="n">retention</span><span class="p">:</span> <span class="mi">7</span>
      <span class="n">interval</span><span class="p">:</span> <span class="s2">&quot;1d&quot;</span>
</pre></div>
</div>
<p>For full task definition configuration consult <a class="reference internal" href="scylla_cluster_crd.html"><span class="doc">Scylla Cluster CRD</span></a>.</p>
<p><strong>Note</strong>: Scylla Manager Agent must have access to above bucket prior the update in order to schedule backup task.
Consult Scylla Manager documentation for details on how to set it up.</p>
<p>Scylla Manager Controller will spot this change and will schedule tasks in Scylla Manager.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">kubectl -n scylla-manager exec -ti scylla-manager-scylla-manager-7bd9f968b9-w25jw -- sctool task list</span>

<span class="go">Cluster: scylla/simple-cluster (d1d532cd-49f2-4c97-9263-25126532803b)</span>
<span class="go">╭─────────────────────────────────────────────────────────────┬──────────────────────────────────────┬────────────────────────────────┬────────╮</span>
<span class="go">│ Task                                                        │ Arguments                            │ Next run                       │ Status │</span>
<span class="go">├─────────────────────────────────────────────────────────────┼──────────────────────────────────────┼────────────────────────────────┼────────┤</span>
<span class="go">│ healthcheck/400b2723-eec5-422a-b7f3-236a0e10575b            │                                      │ 23 Sep 20 14:28:42 CEST (+15s) │ DONE   │</span>
<span class="go">│ backup/275aae7f-c436-4fc8-bcec-479e65fb8372                 │ -L s3:cluster-backups  --retention 3 │ 23 Sep 20 14:28:58 CEST (+7d)  │ NEW    │</span>
<span class="go">│ healthcheck_rest/28169610-a969-4c20-9d11-ab7568b8a1bd       │                                      │ 23 Sep 20 14:29:57 CEST (+1m)  │ NEW    │</span>
<span class="go">│ repair/d4946360-c29d-4bb4-8b9d-619ada495c2a                 │                                      │ 23 Sep 20 14:38:42 CEST        │ NEW    │</span>
<span class="go">╰─────────────────────────────────────────────────────────────┴──────────────────────────────────────┴────────────────────────────────┴────────╯</span>
</pre></div>
</div>
<p>As you can see, we have two new tasks, weekly recurring backup, and one repair which should start shortly.</p>
<p>To check progress of run you can use following command:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">kubectl -n scylla-manager exec -ti scylla-manager-scylla-manager-7bd9f968b9-w25jw -- sctool task progress --cluster d1d532cd-49f2-4c97-9263-25126532803b repair/d4946360-c29d-4bb4-8b9d-619ada495c2a</span>
<span class="go">Status:         RUNNING</span>
<span class="go">Start time:     23 Sep 20 14:38:42 UTC</span>
<span class="go">Duration:       13s</span>
<span class="go">Progress:       2.69%</span>
<span class="go">Datacenters:</span>
<span class="go">  - us-east-1</span>
<span class="go">+--------------------+-------+</span>
<span class="go">| system_auth        | 8.06% |</span>
<span class="go">| system_distributed | 0.00% |</span>
<span class="go">| system_traces      | 0.00% |</span>
<span class="go">+--------------------+-------+</span>
</pre></div>
</div>
<p>Other tasks can be also tracked using the same command, but using different task ID.
Task IDs are present in Cluster Status as well as in task listing.</p>
</section>
<section id="clean-up">
<h2>Clean Up<a class="headerlink" href="#clean-up" title="Permalink to this headline">¶</a></h2>
<p>To clean up all resources associated with Scylla Manager, you can run the commands below.</p>
<p><strong>NOTE:</strong> this will destroy your Scylla Manager database and delete all of its associated data.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">kubectl delete -f examples/common/manager.yaml</span>
</pre></div>
</div>
</section>
<section id="troubleshooting">
<h2>Troubleshooting<a class="headerlink" href="#troubleshooting" title="Permalink to this headline">¶</a></h2>
<p><strong>Manager is not running</strong></p>
<p>If the Scylla Manager does not come up, the first step would be to examine the Manager and Controller logs:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">kubectl -n scylla-manager logs -f scylla-manager-controller-0 scylla-manager-controller</span>
<span class="go">kubectl -n scylla-manager logs -f scylla-manager-controller-0 scylla-manager-scylla-manager-7bd9f968b9-w25jw</span>
</pre></div>
</div>
<p><strong>My task wasn’t scheduled</strong></p>
<p>If your task wasn’t scheduled, Cluster status will be updated with error messages for each failed task.
You can also consult Scylla Manager logs.</p>
<p>Example:</p>
<p>Following status describes error when backup task cannot be scheduled, due to lack of access to bucket:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Status:</span>
<span class="go">  Backups:</span>
<span class="go">    Error:     create backup target: location is not accessible: 10.100.16.62: giving up after 2 attempts: after 15s: timeout - make sure the location is correct and credentials are set, to debug SSH to 10.100.16.62 and run &quot;scylla-manager-agent check-location -L s3:manager-test --debug&quot;; 10.107.193.33: giving up after 2 attempts: after 15s: timeout - make sure the location is correct and credentials are set, to debug SSH to 10.107.193.33 and run &quot;scylla-manager-agent check-location -L s3:manager-test --debug&quot;; 10.109.197.60: giving up after 2 attempts: after 15s: timeout - make sure the location is correct and credentials are set, to debug SSH to 10.109.197.60 and run &quot;scylla-manager-agent check-location -L s3:manager-test --debug&quot;</span>
<span class="go">    Id:        00000000-0000-0000-0000-000000000000</span>
<span class="go">    Interval:  0</span>
<span class="go">    Location:</span>
<span class="go">      s3:manager-test</span>
<span class="go">    Name:         adhoc backup</span>
<span class="go">    Num Retries:  3</span>
<span class="go">    Retention:    3</span>
<span class="go">    Start Date:   now</span>
<span class="go">  Manager Id:     2b9dbe8c-9daa-4703-a66d-c29f63a917c8</span>
<span class="go">  Racks:</span>
<span class="go">    us-east-1a:</span>
<span class="go">      Members:        3</span>
<span class="go">      Ready Members:  3</span>
<span class="go">      Version:        4.0.0</span>
</pre></div>
</div>
<p>Because Controller is infinitely retrying to schedule each defined task, once permission issues will be resolved,
task should appear in task listing and Cluster status.</p>
</section>
</section>

                
                    <div class="post-content">
                        <div class="content-navigation">
    <div class="navigation navigation--prev">
        
            <a class="navigation__link" href="helm.html">
                <button class="navigation__button">
                    <i class="scylla-icon scylla-icon--chevron-left"></i>
                </button>
                <div class="navigation__title">
                    <span class="colored">PREVIOUS</span> <br />Deploying Scylla stack using Helm Charts
                </div>
            </a>
        
    </div>
    <div class="navigation navigation--next">
        
            <a class="navigation__link" href="monitoring.html">
                <div class="navigation__title">
                    <span class="colored">NEXT</span> <br />Monitoring
                </div>
                <button class="navigation__button">
                    <i class="scylla-icon scylla-icon--chevron-right"></i>
                </button>
            </a>
        
    </div>
</div>
                        <!-- Post content text -->
                    </div>
                
            </div>
            <div class="sidebar-left  large-order-1">
                
                    
                        <div id="side-nav" class="side-nav custom-scroll-bar" data-closable data-toggler=".show">
    <button class="collapsible-button">
        <i class="scylla-icon scylla-icon--chevron-left"></i>
    </button>
    <div class="side-nav-content">
        <div class="side-nav__search">
            <div class="search-box">
                <ci-search></ci-search>
            </div>
        </div>
        <div class="side-nav__title">
            Scylla Operator
        </div>
        <div class="side-nav__versions"><ul class="dropdown menu scylla-dropdown scylla-dropdown--versions" data-dropdown-menu>
    <li class="scylla-dropdown__item">
        <a class="scylla-dropdown__title" href="#">
            
                master
            
            <i class="chevron scylla-icon scylla-icon--chevron-right"></i>
        </a>
        <ul class="menu scylla-dropdown__content">
            
                
                    <li>
                        <a href="manager.html">master</a>
                    </li>
                
            
            
        </ul>
    </li>
</ul></div>
        <div class="side-nav__content">
            <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="generic.html">Deploying Scylla on a Kubernetes Cluster</a></li>
<li class="toctree-l1"><a class="reference internal" href="eks.html">Deploying Scylla on EKS</a></li>
<li class="toctree-l1"><a class="reference internal" href="gke.html">Deploying Scylla on GKE</a></li>
<li class="toctree-l1"><a class="reference internal" href="helm.html">Deploying Scylla stack using Helm Charts</a></li>
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">Deploying Scylla Manager on a Kubernetes Cluster</a></li>
<li class="toctree-l1"><a class="reference internal" href="monitoring.html">Monitoring</a></li>
<li class="toctree-l1"><a class="reference internal" href="migration.html">Version  migrations</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="nodeoperations/index.html">Node operations using Scylla Operator</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label for="toctree-checkbox-1"><i class="scylla-icon scylla-icon--expand"></i></label><div class="break"></div><ul>
<li class="toctree-l2"><a class="reference internal" href="nodeoperations/scylla_upgrade.html">Upgrading version of Scylla</a></li>
<li class="toctree-l2"><a class="reference internal" href="nodeoperations/replace_node.html">Replacing a Scylla node</a></li>
<li class="toctree-l2"><a class="reference internal" href="nodeoperations/automatic_cleanup.html">Automatic cleanup and replacement in case when k8s node is lost</a></li>
<li class="toctree-l2"><a class="reference internal" href="nodeoperations/maintenance_mode.html">Maintenance mode</a></li>
<li class="toctree-l2"><a class="reference internal" href="nodeoperations/restore.html">Restore from backup</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="performance.html">Performance tuning</a></li>
<li class="toctree-l1"><a class="reference internal" href="upgrade.html">Upgrade of Scylla Operator</a></li>
<li class="toctree-l1"><a class="reference internal" href="releases.html">Releases</a></li>
<li class="toctree-l1"><a class="reference internal" href="known_issues.html">Known issues</a></li>
<li class="toctree-l1"><a class="reference internal" href="scylla_cluster_crd.html">Scylla Cluster CRD</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributing.html">Contributing to Scylla Operator</a></li>
</ul>

        </div>
    </div>
</div>
                    
                
            </div>
            
                <div class="sidebar-right large-order-3">
                    <div class="secondary-side-nav custom-scroll-bar">
    
    <ul class="contribute">
        <li class="contribute__item">
            <a href="https://github.com/scylladb/scylla-operator/issues/new?title=docs:%20Issue in page Deploying Scylla Manager on a Kubernetes Cluster&&body=I%20would%20like%20to%20report%20an%20issue%20in%20page%20https://operator.docs.scylladb.com/master/manager%0A%0A%23%23%23%20Problem%0A%0A%23%23%23%20%20Suggest%20a%20fix&labels=documentation"
                target="_blank">
                <i class="icon fab fa-github" aria-hidden="true"></i>Create an issue
            </a>
        </li>
        
            <li class="contribute__item">
                <a href="https://github.com/scylladb/scylla-operator/edit/master/docs/source/manager.md"
                    target="_blank">
                    <i class="icon fa fa-edit" aria-hidden="true"></i>Edit this page
                </a>
            </li>
        
    </ul>

    
        <div class="secondary-side-nav__content">
            <p class="topic-title">On this page</p>
            <ul>
<li><a class="reference internal" href="#">Deploying Scylla Manager on a Kubernetes Cluster</a><ul>
<li><a class="reference internal" href="#prerequisites">Prerequisites</a></li>
<li><a class="reference internal" href="#architecture">Architecture</a></li>
<li><a class="reference internal" href="#deploy-scylla-manager">Deploy Scylla Manager</a></li>
<li><a class="reference internal" href="#cluster-registration">Cluster registration</a></li>
<li><a class="reference internal" href="#task-scheduling">Task scheduling</a></li>
<li><a class="reference internal" href="#clean-up">Clean Up</a></li>
<li><a class="reference internal" href="#troubleshooting">Troubleshooting</a></li>
</ul>
</li>
</ul>

        </div>
    
</div>
                </div>
            
        </section>

        <footer class="footer">
    <div class="footer-group">
        <div class="footer-top">
            <a class="footer-logo" href="https://www.scylladb.com">
                <img src="_static/img/logo-scylla-horizontal-RGB.svg" alt="Logo" />
            </a>
            <div class="footer-links">
                <a class="footer-links__link" href="https://docs.scylladb.com/">Docs</a>
                <a class="footer-links__link" href="https://www.scylladb.com/company/contact-us/">Contact Us</a>
                <a class="footer-links__link" href="https://www.scylladb.com/company/">About Us</a>
            </div>
            <div class="footer-actions">
                <a class="footer-actions__link" href="https://groups.google.com/g/scylladb-users" target="_blank">
                    <span data-tooltip tabindex="1" title="User mailing list" data-position="bottom">
                        <img src="_static/img/icons/icon-mail-list.svg" alt="Mail List Icon" />
                    </span>
                </a>
                <a class="footer-actions__link" href="http://slack.scylladb.com/" target="_blank">
                    <span data-tooltip tabindex="1" title="User Slack channel" data-position="bottom">
                        <img src="_static/img/icons/icon-slack.svg" alt="Slack Icon" />
                    </span>
                </a>
                <a class="footer-actions__link" href="https://forum.scylladb.com/" target="_blank">
                    <span data-tooltip tabindex="1" title="Community forum" data-position="bottom">
                        <img src="_static/img/icons/icon-forum.svg" alt="Forum Icon" />
                    </span>
                </a>
            </div>
        </div>

        <div class="footer-bottom">
            
                <div class="footer-bottom__copyright">
                    
                        
                            &#169; 2023, ScyllaDB. All rights reserved.
                        
                    
                </div>
            
            
                <div class="footer-bottom__last-updated">
                    
                        Last updated on 18 May 2023.
                    
                </div>
            
            <div class="footer-bottom__version">
                Powered by
                <a href="http://sphinx-doc.org/">Sphinx 4.5.0</a> &amp;
                <a href="https://sphinx-theme.scylladb.com/">ScyllaDB Theme 1.3.5</a>
            </div>
        </div>
    </div>
</footer>

        <noscript>
            <iframe src="https://www.googletagmanager.com/ns.html?id=GTM-T8P2JP" height="0" width="0"
                style="display: none; visibility: hidden"></iframe>
        </noscript>
    </body>

</html>